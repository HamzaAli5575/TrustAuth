{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';import{useNavigate}from'react-router-dom';import api from'../api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Callback=()=>{const navigate=useNavigate();const[status,setStatus]=useState('Authenticating...');const hasBeenCalled=useRef(false);const processing=useRef(false);// NEW: Lock to prevent race condition\nuseEffect(()=>{if(hasBeenCalled.current)return;hasBeenCalled.current=true;const handleCallback=async()=>{if(processing.current)return;// NEW: Prevent double run\nprocessing.current=true;// Lock\ntry{const params=new URLSearchParams(window.location.search);const code=params.get('code');if(!code){setStatus('No code found. Redirecting...');setTimeout(()=>navigate('/',{replace:true}),1500);return;}setStatus('Exchanging token...');const res=await api.get(\"/auth/callback?code=\".concat(code));setStatus('Verifying user...');localStorage.setItem('token',res.data.accessToken);localStorage.setItem('user',JSON.stringify(res.data.user));setStatus('Success!');// Force hard redirect to Dashboard immediately on success\nsetTimeout(()=>{window.location.href='/dashboard';},500);}catch(err){console.error('Callback Error:',err);setStatus('Error clearing cache...');// NEW: Wait a moment then go home\nsetTimeout(()=>{navigate('/',{replace:true});},2000);}finally{processing.current=false;// Unlock\n}};handleCallback();},[navigate]);return/*#__PURE__*/_jsxs(\"div\",{style:{height:'100vh',background:'#f1f5f9',display:'grid',placeItems:'center',flexDirection:'column',gap:'15px',fontSize:'1.4rem',color:'#0f172a'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'3rem',animation:'spin 1s linear infinite'},children:\"\\u26A1\\uFE0F\"}),/*#__PURE__*/_jsx(\"div\",{children:status}),status.includes('Error')&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.9rem',color:'#ef4444',marginTop:'1rem'},children:\"Redirecting to login...\"})]});};export default Callback;","map":{"version":3,"names":["React","useEffect","useState","useRef","useNavigate","api","jsx","_jsx","jsxs","_jsxs","Callback","navigate","status","setStatus","hasBeenCalled","processing","current","handleCallback","params","URLSearchParams","window","location","search","code","get","setTimeout","replace","res","concat","localStorage","setItem","data","accessToken","JSON","stringify","user","href","err","console","error","style","height","background","display","placeItems","flexDirection","gap","fontSize","color","children","animation","includes","marginTop"],"sources":["C:/Users/Hp/Desktop/work/InterviewProject/AuthProject/r-auth-native/client/src/components/Callback.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../api';\r\n\r\nconst Callback = () => {\r\n  const navigate = useNavigate();\r\n  const [status, setStatus] = useState('Authenticating...');\r\n  const hasBeenCalled = useRef(false);\r\n  const processing = useRef(false); // NEW: Lock to prevent race condition\r\n\r\n  useEffect(() => {\r\n    if (hasBeenCalled.current) return;\r\n    hasBeenCalled.current = true;\r\n\r\n    const handleCallback = async () => {\r\n      if (processing.current) return; // NEW: Prevent double run\r\n      processing.current = true; // Lock\r\n\r\n      try {\r\n        const params = new URLSearchParams(window.location.search);\r\n        const code = params.get('code');\r\n\r\n        if (!code) {\r\n          setStatus('No code found. Redirecting...');\r\n          setTimeout(() => navigate('/', { replace: true }), 1500);\r\n          return;\r\n        }\r\n\r\n        setStatus('Exchanging token...');\r\n        const res = await api.get(`/auth/callback?code=${code}`);\r\n        \r\n        setStatus('Verifying user...');\r\n        localStorage.setItem('token', res.data.accessToken);\r\n        localStorage.setItem('user', JSON.stringify(res.data.user));\r\n\r\n        setStatus('Success!');\r\n        \r\n        // Force hard redirect to Dashboard immediately on success\r\n        setTimeout(() => {\r\n          window.location.href = '/dashboard';\r\n        }, 500);\r\n\r\n      } catch (err) {\r\n        console.error('Callback Error:', err);\r\n        setStatus('Error clearing cache...');\r\n\r\n        // NEW: Wait a moment then go home\r\n        setTimeout(() => {\r\n          navigate('/', { replace: true });\r\n        }, 2000);\r\n      } finally {\r\n        processing.current = false; // Unlock\r\n      }\r\n    };\r\n\r\n    handleCallback();\r\n  }, [navigate]);\r\n\r\n  return (\r\n    <div style={{ \r\n      height: '100vh', \r\n      background: '#f1f5f9', \r\n      display: 'grid', \r\n      placeItems: 'center', \r\n      flexDirection: 'column',\r\n      gap: '15px',\r\n      fontSize: '1.4rem',\r\n      color: '#0f172a'\r\n    }}>\r\n      <div style={{ fontSize: '3rem', animation: 'spin 1s linear infinite' }}>⚡️</div>\r\n      <div>{status}</div>\r\n      {status.includes('Error') && <div style={{ fontSize: '0.9rem', color: '#ef4444', marginTop: '1rem' }}>Redirecting to login...</div>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Callback;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}